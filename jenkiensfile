// env-vars.html
CODE_CHANGES = getGitChanges()
pipeline{

    agent any
    paramaters{
        booleanParamaters(name:"executeTest", defaultvalue:true, description:'')
        choice(name:"VERSION", choices:['1.2.3','2.4.5', '3.4.5'], description:'')
    }
    environment{
        NEW_VERSION = '1.3.4'
        SERVER_CREDENTIALS = credentials(" server id get from credentials in jenkins UI")
    }
    tools{
        maven 'Maven'
    }

    stages{

        stage('build'){

            when {
                expression {
                // run onlu code changes on dev env
                //    env.BRANCH_NAME == 'dev' && CODE_CHANGES == true

                params.executeTest == true
                }
            }
            steps {

                echo "Hello World"
                echo "building version ${NEW_VERSION}"
                echo "building version ${SERVER_CREDENTIALS}"
                sh "ls"

                script {
                    gv = load "script.groovy"
                    gv.buildApp()
                    gv.testApp()
                    gv.deployApp()
                }
            }
        }

        stage('test'){
            when {
                expression {
                // run either branch
                    env.BRANCH_NAME == 'dev' || env.BRANCH_NAME == 'master'
                }
            }

            steps {

                echo "Hello World"
            }
        }

         stage('deploy'){

            steps {

                echo "Hello World"
                withCredentials([
                usernamePassword(credentials: 'server-credentials', usernameVariable:USER, passwordVariable: PWD)
                ]){
                    sh "Some script ${USER} ${PWD}"
                }
            }
        }
    }
    post {
        always {
        }
        success {
        }
        failure{
        }
    }
}



















